---
# =============================================================================
# Loki Setup Tasks
# =============================================================================

- name: Create Loki data directories
  ansible.builtin.file:
    path: "{{ loki_data_path }}/{{ item }}"
    state: directory
    mode: '0755'
    owner: root
    group: root
  loop:
    - index
    - cache
    - chunks
    - compactor
    - rules
    - rules-temp
    - wal

- name: Deploy Loki configuration
  ansible.builtin.template:
    src: loki-config.yml.j2
    dest: "{{ loki_data_path }}/loki-config.yml"
    mode: '0644'
    owner: root
    group: root
  notify: Restart logging stack

- name: Set correct permissions for Loki data directories
  ansible.builtin.file:
    path: "{{ loki_data_path }}"
    state: directory
    owner: 10001
    group: 10001
    recurse: true
    mode: '0755'

