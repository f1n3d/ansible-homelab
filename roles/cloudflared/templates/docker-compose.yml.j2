{{ ansible_managed | comment }}
# Cloudflared Tunnel Docker Compose

services:
  cloudflared:
    image: {{ cloudflared_image }}
    container_name: {{ cloudflared_container_name }}
    restart: unless-stopped
    command: tunnel --no-autoupdate run
    user: "65532:65532"
    read_only: true
    cap_drop:
      - ALL
    cap_add:
      - NET_BIND_SERVICE
    security_opt:
      - no-new-privileges:true
    environment:
      TUNNEL_TOKEN: ${TUNNEL_TOKEN}
    deploy:
      resources:
        limits:
          memory: 256M
          cpus: '0.5'
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
