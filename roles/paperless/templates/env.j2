# {{ ansible_managed }}
# Paperless-NGX Environment Configuration

###############################################################################
# PostgreSQL Database
###############################################################################
POSTGRES_DB={{ paperless_postgres_db }}
POSTGRES_USER={{ paperless_postgres_user }}
POSTGRES_PASSWORD={{ paperless_postgres_password }}

###############################################################################
# Paperless Database Connection
###############################################################################
PAPERLESS_DBHOST=db
PAPERLESS_DBNAME={{ paperless_postgres_db }}
PAPERLESS_DBUSER={{ paperless_postgres_user }}
PAPERLESS_DBPASS={{ paperless_postgres_password }}

###############################################################################
# Redis
###############################################################################
PAPERLESS_REDIS={{ paperless_redis_url }}

###############################################################################
# Tika & Gotenberg (Office Document Support)
###############################################################################
PAPERLESS_TIKA_ENABLED={{ paperless_tika_enabled }}
PAPERLESS_TIKA_ENDPOINT={{ paperless_tika_endpoint }}
PAPERLESS_TIKA_GOTENBERG_ENDPOINT={{ paperless_gotenberg_endpoint }}

###############################################################################
# User Mapping
###############################################################################
USERMAP_UID={{ paperless_usermap_uid }}
USERMAP_GID={{ paperless_usermap_gid }}

###############################################################################
# Application Settings
###############################################################################
{% if paperless_url is defined %}
PAPERLESS_URL={{ paperless_url }}
{% endif %}
{% if paperless_secret_key is defined %}
PAPERLESS_SECRET_KEY={{ paperless_secret_key }}
{% endif %}
PAPERLESS_TIME_ZONE={{ paperless_timezone }}

###############################################################################
# OCR Settings
###############################################################################
PAPERLESS_OCR_LANGUAGE={{ paperless_ocr_language }}
PAPERLESS_OCR_MODE={{ paperless_ocr_mode }}
PAPERLESS_OCR_SKIP_ARCHIVE_FILE={{ paperless_ocr_skip_archive_file }}
PAPERLESS_OCR_IMAGE_DPI={{ paperless_ocr_image_dpi }}
PAPERLESS_OCR_CLEAN={{ paperless_ocr_clean }}
{% if paperless_ocr_languages %}
PAPERLESS_OCR_LANGUAGES={{ paperless_ocr_languages }}
{% endif %}

###############################################################################
# Task Workers
###############################################################################
PAPERLESS_TASK_WORKERS={{ paperless_task_workers }}
PAPERLESS_THREADS_PER_WORKER={{ paperless_threads_per_worker }}

###############################################################################
# Consumer Settings
###############################################################################
PAPERLESS_CONSUMER_RECURSIVE={{ paperless_consumer_recursive }}
PAPERLESS_CONSUMER_SUBDIRS_AS_TAGS={{ paperless_consumer_subdirs_as_tags }}
{% if paperless_filename_format %}
PAPERLESS_FILENAME_FORMAT={{ paperless_filename_format }}
{% endif %}

###############################################################################
# Admin User (created on first start)
###############################################################################
{% if paperless_admin_user is defined %}
PAPERLESS_ADMIN_USER={{ paperless_admin_user }}
{% endif %}
{% if paperless_admin_password is defined %}
PAPERLESS_ADMIN_PASSWORD={{ paperless_admin_password }}
{% endif %}
{% if paperless_admin_email is defined %}
PAPERLESS_ADMIN_MAIL={{ paperless_admin_email }}
{% endif %}

###############################################################################
# OIDC / Social Authentication (optional)
###############################################################################
{% if paperless_oidc_enabled | default(false) %}
PAPERLESS_APPS=allauth.socialaccount.providers.openid_connect
PAPERLESS_SOCIALACCOUNT_PROVIDERS={"openid_connect":{"SCOPE":["openid","profile","email"],"OAUTH_PKCE_ENABLED":true,"APPS":[{"provider_id":"{{ paperless_oidc_provider_id }}","name":"{{ paperless_oidc_provider_name }}","client_id":"{{ paperless_oidc_client_id }}","secret":"{{ paperless_oidc_client_secret }}","settings":{"server_url":"{{ paperless_oidc_issuer }}.well-known/openid-configuration"}}]}}
# Automatische Account-Erstellung bei OIDC-Login (für neue Benutzer)
PAPERLESS_ACCOUNT_ALLOW_SIGNUPS={{ paperless_account_allow_signups | default('false') }}
# Automatischer Login ohne Bestätigungsseite ("Drittkonto verknüpfen")
PAPERLESS_SOCIAL_AUTO_SIGNUP=true
# E-Mail-Verifikation (none = Authentik hat bereits verifiziert)
PAPERLESS_SOCIALACCOUNT_EMAIL_VERIFICATION={{ paperless_socialaccount_email_verification | default('none') }}
# Automatische Verknüpfung bestehender Accounts über E-Mail-Adresse
PAPERLESS_SOCIALACCOUNT_EMAIL_AUTHENTICATION=true
PAPERLESS_SOCIALACCOUNT_EMAIL_AUTHENTICATION_AUTO_CONNECT=true
# SSO-Redirect: Login-Seite leitet direkt zu Authentik weiter
PAPERLESS_REDIRECT_LOGIN_TO_SSO=true
# Normalen Login deaktivieren (nur SSO, API-Keys funktionieren weiterhin)
PAPERLESS_DISABLE_REGULAR_LOGIN={{ paperless_disable_regular_login | default('true') }}
{% endif %}
